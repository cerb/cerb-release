{
    "name": "ai.cerb.eventHandler.automation",
    "description": "",
    "extension_id": "cerb.trigger.interaction.internal",
    "script": "start:\r\n  outcome/notRoot:\r\n    if@bool: {{'' != caller_params.token_path}}\r\n    then:\r\n      await:\r\n        form:\r\n          title: Automation Event Editor\r\n          elements:\r\n            say:\r\n              content@text:\r\n                #### You can only add automations at the root level (no indentation).\r\n            submit:\r\n              buttons:\r\n                continue/close:\r\n                  label: Close\r\n                  value: close\r\n      return:\r\n  \r\n  await:\r\n    form:\r\n      title: Automation Event Builder\r\n      elements:\r\n        sheet/prompt_automation_id:\r\n          label: Choose an automation:\r\n          data:\r\n            automation:\r\n              uri: cerb:automation:cerb.data.records\r\n              inputs:\r\n                record_type: automation\r\n                query@text:\r\n                  trigger:${trigger} sort:name\r\n                query_params:\r\n                  trigger: {{caller_params.trigger}}\r\n          limit: 20\r\n          required@bool: yes\r\n          schema:\r\n            layout:\r\n              paging@bool: yes\r\n              headings@bool: no\r\n              filtering@bool: yes\r\n              style: columns\r\n              params:\r\n                width: 300\r\n            columns:\r\n              selection/id:\r\n                params:\r\n                  mode: single\r\n                  label_key: _label\r\n              text/description:\r\n          toolbar:\r\n            interaction/add:\r\n              label: Create\r\n              icon: circle-plus\r\n              hidden@bool: {{not worker_is_superuser}}\r\n              uri: cerb:automation:ai.cerb.automation.create\r\n        \r\n        submit:\r\n          continue@bool: no\r\n          reset@bool: no\r\n\r\n  set/load_automation:\r\n    automation_data__context: automation\r\n    automation_data_id@key: prompt_automation_id\r\n    snippet_uid: {{random_string(6)|lower}}\r\n    _load_inputs: {% do automation_data_inputs %}\r\n    \r\n  var.set/snippet:\r\n    inputs:\r\n      key: snippet:automation/{{snippet_uid}}\r\n      value:\r\n        uri: cerb:automation:{{automation_data_name}}\r\n        disabled@raw,bool: no\r\n  \r\n  outcome/inputs:\r\n    if@bool:\r\n      {{\r\n        automation_data_inputs is iterable\r\n        and automation_data_inputs is not empty\r\n      }}\r\n    then:\r\n      repeat:\r\n        each@csv: {{automation_data_inputs|keys|join(',')}}\r\n        as: idx\r\n        do:\r\n          decision/type:\r\n            outcome/array:\r\n              if@bool: {{'array' == automation_data_inputs[idx].type}}\r\n              then:\r\n                var.set:\r\n                  inputs:\r\n                    key: snippet:automation/{{snippet_uid}}:inputs:{{automation_data_inputs[idx].key}}\r\n                    value@list:\r\n                      Option 1\r\n                      Option 2\r\n            outcome/record:\r\n              if@bool: {{'record' == automation_data_inputs[idx].type}}\r\n              then:\r\n                var.set:\r\n                  inputs:\r\n                    key: snippet:automation/{{snippet_uid}}:inputs:{{automation_data_inputs[idx].key}}\r\n                    value@int: 123\r\n            outcome/records:\r\n              if@bool: {{'records' == automation_data_inputs[idx].type}}\r\n              then:\r\n                var.set:\r\n                  inputs:\r\n                    key: snippet:automation/{{snippet_uid}}:inputs:{{automation_data_inputs[idx].key}}\r\n                    value@csv: 1,2,3\r\n            outcome/else:\r\n              then:\r\n                var.set:\r\n                  inputs:\r\n                    key: snippet:automation/{{snippet_uid}}:inputs:{{automation_data_inputs[idx].key}}\r\n                    value: your value\r\n                \r\n  return:\r\n    snippet@text: {{snippet|kata_encode}}",
    "policy_kata": "",
    "created_at": 1600722810,
    "updated_at": 1642529842
}
{
  "package": {
    "name": "Bot Behavior: Auto-Reply Template",
    "revision": 1,
    "requires": {
      "cerb_version": "9.2.0",
      "plugins": [

      ]
    },
    "library": {
      "name": "Auto-Reply",
      "uri": "cerb_bot_behavior_auto_reply",
      "description": "A behavior that automatically replies to new messages",
      "point": "behavior",
      "image": ""
    },
    "configure": {
      "placeholders": [

      ],
      "prompts": [
        {
          "type": "chooser",
          "label": "Bot",
          "key": "bot_id",
          "hidden": true,
          "params": {
            "context": "cerberusweb.contexts.bot",
            "single": true,
            "query": ""
          }
        }
      ]
    }
  },
  "behaviors": [
    {
      "uid": "behavior_autoreply",
      "bot_id": "{{{bot_id}}}",
      "title": "Automatically respond to new conversations",
      "is_disabled": false,
      "is_private": false,
      "priority": 50,
      "event": {
        "key": "event.mail.received",
        "label": "New message added to ticket"
      },
      "nodes": [
        {
          "type": "switch",
          "title": "Is this a new conversation?",
          "status": "live",
          "nodes": [
            {
              "type": "outcome",
              "title": "Yes",
              "status": "live",
              "params": {
                "groups": [
                  {
                    "any": 0,
                    "conditions": [
                      {
                        "condition": "is_first",
                        "bool": "1"
                      },
                      {
                        "condition": "is_outgoing",
                        "bool": "0"
                      }
                    ]
                  }
                ]
              },
              "nodes": [
                {
                  "type": "switch",
                  "title": "Does the message have auto-reply characteristics?",
                  "status": "live",
                  "nodes": [
                    {
                      "type": "outcome",
                      "title": "Yes, it has an Auto-Submitted header",
                      "status": "live",
                      "params": {
                        "groups": [
                          {
                            "any": 0,
                            "conditions": [
                              {
                                "condition": "headers",
                                "header": "Auto-Submitted",
                                "oper": "!is",
                                "value": ""
                              },
                              {
                                "condition": "headers",
                                "header": "Auto-Submitted",
                                "oper": "!is",
                                "value": "no"
                              }
                            ]
                          }
                        ]
                      }
                    },
                    {
                      "type": "outcome",
                      "title": "Yes, it has Preference/Precedence headers",
                      "status": "live",
                      "params": {
                        "groups": [
                          {
                            "any": 1,
                            "conditions": [
                              {
                                "condition": "headers",
                                "header": "Preference",
                                "oper": "is",
                                "value": "auto_reply"
                              },
                              {
                                "condition": "headers",
                                "header": "Precedence",
                                "oper": "is",
                                "value": "bulk"
                              }
                            ]
                          }
                        ]
                      }
                    },
                    {
                      "type": "outcome",
                      "title": "Yes, it has X-Precedence, X-Autorespond, X-Autogenerated, or X-AutoReply-From headers",
                      "status": "live",
                      "params": {
                        "groups": [
                          {
                            "any": 1,
                            "conditions": [
                              {
                                "condition": "headers",
                                "header": "X-Autogenerated",
                                "oper": "!is",
                                "value": ""
                              },
                              {
                                "condition": "headers",
                                "header": "X-AutoReply",
                                "oper": "!is",
                                "value": ""
                              },
                              {
                                "condition": "headers",
                                "header": "X-AutoReply-From",
                                "oper": "!is",
                                "value": ""
                              },
                              {
                                "condition": "headers",
                                "header": "X-Autorespond",
                                "oper": "!is",
                                "value": ""
                              },
                              {
                                "condition": "headers",
                                "header": "X-Precedence",
                                "oper": "is",
                                "value": "auto_reply"
                              }
                            ]
                          }
                        ]
                      }
                    },
                    {
                      "type": "outcome",
                      "title": "Yes, it has an Out of Office subject",
                      "status": "live",
                      "params": {
                        "groups": [
                          {
                            "any": 1,
                            "conditions": [
                              {
                                "condition": "headers",
                                "header": "Subject",
                                "oper": "contains",
                                "value": "Out of Office"
                              },
                              {
                                "condition": "headers",
                                "header": "Subject",
                                "oper": "contains",
                                "value": "is out of the office"
                              }
                            ]
                          }
                        ]
                      }
                    },
                    {
                      "type": "outcome",
                      "title": "Yes, it has an Auto Response subject",
                      "status": "live",
                      "params": {
                        "groups": [
                          {
                            "any": 1,
                            "conditions": [
                              {
                                "condition": "headers",
                                "header": "Subject",
                                "oper": "contains",
                                "value": "Auto Response"
                              },
                              {
                                "condition": "headers",
                                "header": "Subject",
                                "oper": "contains",
                                "value": "AutoReply"
                              }
                            ]
                          }
                        ]
                      }
                    },
                    {
                      "type": "outcome",
                      "title": "No",
                      "status": "live",
                      "params": {
                        "groups": [
                          {
                            "any": 0,
                            "conditions": [

                            ]
                          }
                        ]
                      },
                      "nodes": [
                        {
                          "type": "action",
                          "title": "Send auto-reply message",
                          "status": "live",
                          "params": {
                            "actions": [
                              {
                                "action": "send_email",
                                "from_address_id": "0",
                                "send_as": "",
                                "to": "{{sender_address}}",
                                "cc": "",
                                "bcc": "",
                                "subject": "Received: {{ticket_subject}} [#{{ticket_mask}}]",
                                "headers": "Auto-Submitted: auto-replied",
                                "format": "",
                                "content": "***** THIS IS AN AUTOMATED MESSAGE *****\r\n\r\n{% if sender_contact_first_name %}\r\nHi {{sender_contact_first_name}},\r\n\r\n{% endif %}\r\nThis is a confirmation that we have received your message.\r\n\r\nReference #: {{ticket_mask}}\r\nSubject: {{ticket_subject}}\r\n\r\nWe'll respond as soon as possible.\r\n\r\nThanks for contacting us!\r\n\r\n-- \r\nSupport",
                                "run_in_simulator": "0"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
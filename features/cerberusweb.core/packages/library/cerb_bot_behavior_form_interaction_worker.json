{
	"package": {
		"name": "Bot Form Interaction Template",
		"revision": 1,
		"requires": {
			"cerb_version": "9.3.0",
			"plugins": [

			]
		},
		"library": {
			"name": "Form interaction with worker",
			"uri": "cerb_bot_behavior_form_interaction_worker",
			"description": "A template for building worker-based form interactions",
			"point": "behavior",
			"image": "data:image/png;base64,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"
		},
		"configure": {
			"placeholders": [

			],
			"prompts": [
				{
					"type": "chooser",
					"label": "Bot",
					"key": "bot_id",
					"hidden": true,
					"params": {
						"context": "cerberusweb.contexts.bot",
						"single": true,
						"query": ""
					}
				}
			]
		}
	},
	"behaviors": [
		{
			"uid": "behavior_form_interaction",
			"_context": "behavior",
			"bot_id": "{{{bot_id}}}",
			"title": "Form: Create linked task",
			"is_disabled": false,
			"is_private": false,
			"priority": 50,
			"event": {
				"key": "event.form.interaction.worker",
				"label": "Form interaction"
			},
			"variables": {
				"var_record_type": {
					"key": "var_record_type",
					"label": "Record Type",
					"type": "S",
					"is_private": false,
					"params": {
						"widget": "single"
					}
				},
				"var_record_id": {
					"key": "var_record_id",
					"label": "Record ID",
					"type": "N",
					"is_private": false,
					"params": [

					]
				}
			},
			"nodes": [
				{
					"type": "action",
					"title": "Form: Create a task",
					"status": "live",
					"params": {
						"actions": [
							{
								"action": "respond_text",
								"message": "# Create Task",
								"format": "markdown"
							},
							{
								"action": "prompt_text",
								"label": "Summary:",
								"placeholder": "(e.g. \"Release new version\")",
								"default": "",
								"mode": "",
								"var": "prompt_summary",
								"var_format": "",
								"var_validate": "{% if prompt_summary is empty %}\r\nThe task summary is required.\r\n{% endif %}"
							},
							{
								"action": "prompt_radios",
								"label": "Priority:",
								"style": "radios",
								"orientation": "horizontal",
								"options": "Low\r\nNormal\r\nHigh\r\nUrgent",
								"default": "Normal",
								"var": "prompt_priority",
								"var_format": "",
								"var_validate": "{% if prompt_priority is empty %}\r\nThe task priority is required.\r\n{% endif %}"
							},
							{
								"action": "prompt_text",
								"label": "Due Date:",
								"placeholder": "(e.g. next Friday 5pm)",
								"default": "",
								"mode": "",
								"var": "prompt_due",
								"var_format": "",
								"var_validate": "{% if prompt_due is not empty and prompt_due|date('U') == 0 %}\r\nThe task due date is invalid.\r\n{% elseif prompt_due is not empty and prompt_due|date('U') < date('now')|date('U') %}\r\nThe task due date must be in the future.\r\n{% endif %}"
							},
							{
								"action": "prompt_radios",
								"label": "Owner:",
								"style": "radios",
								"orientation": "horizontal",
								"options": "nobody\r\nme",
								"default": "me",
								"var": "prompt_owner",
								"var_format": "",
								"var_validate": "{% if prompt_owner is empty %}\r\nThe task owner is required.\r\n{% endif %}"
							},
							{
								"action": "prompt_submit"
							}
						]
					}
				},
				{
					"type": "action",
					"title": "Create task record",
					"status": "live",
					"params": {
						"actions": [
							{
								"action": "core.bot.action.record.create",
								"context": "task",
								"changeset_json": "{% set importances = { '': 0, Low: 25, Normal: 50, High: 75, Urgent: 90 } %}\r\n{% set owners = { '': 0, 'nobody': 0, 'me': worker_id } %}\r\n{% set json = {\r\n\ttitle: prompt_summary,\r\n\tdue: prompt_due|date('U'),\r\n\timportance: importances[prompt_priority],\r\n\towner_id: owners[prompt_owner]\r\n} %}\r\n{% if var_record_type is not empty and var_record_id is not empty %}\r\n{% set json = dict_set(json, 'links', [ var_record_type ~ ':' ~ var_record_id ]) %}\r\n{% endif %}\r\n{{json|json_encode|json_pretty}}",
								"run_in_simulator": "0",
								"object_placeholder": "_record"
							}
						]
					}
				},
				{
					"type": "action",
					"title": "Display sheet for new record",
					"status": "live",
					"params": {
						"actions": [
							{
								"action": "respond_text",
								"message": "# Task created!",
								"format": "markdown"
							},
							{
								"action": "respond_sheet",
								"data_query": "type:worklist.records\nof:task\nquery.required:(\n  id:{{_record.id}}\n)\nquery:(\n)\nexpand:[]\nformat:dictionaries",
								"placeholder_simulator_yaml": "# key: value\n_record:\n  id: 1",
								"sheet_yaml": "layout:\n  style: fieldsets\n  headings: true\n  paging: false\ncolumns:\n- card:\n    key: _label\n    label: Task\n- card:\n    key: owner__label\n    label: Owner\n    params:\n      image: true\n- slider:\n    key: importance\n- date:\n    key: due\n    label: Due\n- date:\n    key: updated\n    label: Updated\n- "
							}
						]
					}
				}
			]
		}
	]
}